name: "Pull Request Feedback"
description: ""
author: "Exit0 Team"
inputs:
  capture_stdout:
    description: "Whether to capture and return the standard output of the executed commands."
    required: false
    default: "true"



outputs:
  stdout:
    description: "Standard output of the executed commands when capture_stdout is enabled."
    value: ${{ steps.entrypoint.outputs.stdout }}

runs:
  using: "composite"
  steps:
    - name: Check Action Version
      shell: bash
      run: |
        # Checking action version

        CURRENT_REF="${{ github.action_ref }}"
        if [[ "$CURRENT_REF" =~ ^v[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
          LATEST_TAG=$(git -c 'versionsort.suffix=-' ls-remote --tags --refs --sort='v:refname' https://github.com/${{ github.action_repository }} | tail -n1 | sed 's/.*\///')
          if [ "$CURRENT_REF" != "$LATEST_TAG" ]; then
            echo "::warning::You are using $CURRENT_REF. A newer version $LATEST_TAG is available."
          fi
        fi
        echo "::endgroup::"

    - name: Install OIDC Client from Core Package
      shell: bash
      run: npm install @actions/core@1.6.0 @actions/http-client
    - name: Get Id Token
      uses: actions/github-script@v8
      id: idtoken
      with:
        script: |
          const coredemo = require('@actions/core')
          let id_token = await coredemo.getIDToken()
          coredemo.setOutput('id_token', id_token)

    - id: entrypoint
      name: Run entrypoint.sh
      run: entrypoint.sh
      shell: bash
      env:
        GITHUB_OIDC_TOKEN: ${{ steps.idtoken.outputs.id_token }}
        PR_NUMBER: ${{ github.event.pull_request.number }}
        LINKED_ISSUE_NUMBER: 

branding:
  icon: "award"
  color: "green"
